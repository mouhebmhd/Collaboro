<!DOCTYPE html>
<html lang="fr">

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Collaboro | Sprints</title>
  <link rel="stylesheet" href="/assets/css/style.css">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/assets/js/navbar.js"></script>
</head>

<body>
  <div class="container-scroller  ">
    <!--navbar start-->
    <nav class="navbar  fixed-top navbar-light shadow-sm  d-flex  align-items-center ">
      <a class="navbar-brand " href="/index">
        <img src="/assets/img/logo.png" class="d-inline-block align-top"> </a>
      <ul class="nav justify-content-end ">
        <li class="nav-item navbar-item">
          <a class="nav-link count-indicator " href="/chat">
            <i class="bi bi-envelope-fill mr-5 "></i>
            <span class="count1"></span>
          </a>
        </li>
        <li class="nav-item navbar-item">
          <a class="nav-link count-indicator " href="/notification">
            <i class="bi bi-bell-fill mr-4 "></i>
            <span class="count"></span>
          </a>
        </li>
        <li class="nav-item  mr-5 navbar-item">
          <a class="nav-link profile-photo " href="/EditMyProfile/<%= data._id%>"><img src="<%=data.photo%>">
          </a>
        </li>


      </ul>
    </nav>
    <!--navbar end-->
    <div class="container-fluid page-body-wrapper" id="chat-container">
      <!--sidebar start-->
      <nav class="sidebar shadow flex-row align-items-start mx-0 px-0  " id="sidebar">
        <ul class="nav" id="sidebar">
          <li class="nav-item nav-link">
            <button onclick="toggleNavbar()" class="btn btn-lg  " id="btnToggler"><i
                class="bi bi-arrow-return-left"></i></button>
          </li>
          <li class="nav-item  ">
            <a class="nav-link" href="/dashboard">
              <i class="bi bi-grid"></i>
              <span class="menu-title mx-2">Acceuil</span>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" data-toggle="collapse" href="/projets">
              <i class="bi bi-code-square"></i>
              <span class="menu-title mx-2 ">Projets</span>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" data-toggle="collapse" href="/sprints">
              <i class="bi bi-arrow-repeat"></i>
              <span class="menu-title mx-2 ">Sprints</span>
            </a>
          </li>

          <li class="nav-item ">
            <a class="nav-link" data-toggle="collapse" href="/taches">
              <i class="bi bi-list-task"></i>
              <span class="menu-title mx-2">Tâches</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/meeting">
              <i class="bi bi-camera-video"></i>
              <span class="menu-title mx-2 ">Meeting</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/chat">
              <i class="bi bi-chat-left"></i>
              <span class="menu-title mx-2">Chat</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/chat">
              <i class="bi bi-bell"></i>
              <span class="menu-title mx-2">Notification</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/EditMyProfile">
              <i class="bi bi-people"></i>
              <span class="menu-title mx-2">Profil</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/documentation">
              <i class="bi bi-book"></i>
              <span class="menu-title mx-2">Documentation</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/">
              <i class="bi bi-box-arrow-left"></i>
              <span class="menu-title mx-2">Déconnexion</span>
            </a>
          </li>
        </ul>
      </nav>
      <nav class="mobile-sidebar shadow  flex-row align-items-start mx-0 px-0    " id="mobile-sidebar">
        <ul class="nav">
          <li class="nav-item">
            <button onclick="toggleNavbar()" class="btn btn-lg " id="btnToggler"><i
                class="bi bi-arrow-return-right"></i></button>
          </li>
          <li class="nav-item  ">
            <a class="nav-link" href="/dashboard">
              <i class="bi bi-grid"></i>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" data-toggle="collapse" href="/projets">
              <i class="bi bi-code-square"></i>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" data-toggle="collapse" href="/sprints">
              <i class="bi bi-arrow-repeat"></i>
            </a>
          </li>
          <li class="nav-item ">
            <a class="nav-link" data-toggle="collapse" href="/taches">
              <i class="bi bi-list-task"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/meeting">
              <i class="bi bi-camera-video"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/chat">
              <i class="bi bi-chat-left"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/notification">
              <i class="bi bi-bell"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/EditMyProfile">
              <i class="bi bi-people"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/documentation">
              <i class="bi bi-book"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="/logout">
              <i class="bi bi-box-arrow-left"></i>
            </a>
          </li>
        </ul>
      </nav>
      <div class=" container-fluid main-panel" id=main-panel-home>
        <div class="content-wrapper" id="main-panel-wrapper">

            <div class="row d-flex flex-column p-2">
                <div class="col m-1 PageTitle h4 ml-0 p-0 d-flex justify-content-between">
                    <p>Statistique  de Projet</p>
                    <div class="d-flex">
                        <a type="button" class="btn btn-danger mr-3 pt-2" href="/project/impedimentLog/<%=projet._id%>">Journal des obstacles<i class="bi bi-bug ml-1 "></i></a>
                        <a type="button" class="btn btn-secondary mr-3 pt-2" href="/project/riskLog/<%=projet._id%>">Journal des risques<i class="bi bi-cone ml-1 "></i></a>
                        <a type="button" class="btn add-button text-light pt-2 mr-3 <%if(data._id!=projet.identifiantScrumMaster){%>d-none<%}%>" href="/project/sprints/startOne/<%=projet._id%>">Créer une nouvelle sprint<i class="bi bi-plus-lg ml-1 "></i></a>
                        <a type="button" class="btn history btn-warning text-dark  mr-3 pt-2" href="/api/sprintsList/<%=projet._id%>">Liste des sprints<i class="bi bi-journals ml-1 "></i></a>

                    </div>
                  </div>
                    <div class="row">
                      <div
                          class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                          <p class="h5 text-muted"><span class=" h1 PageTitle"><%=stats[0]%></span> Sprints </p>
                      </div>
                      <div
                          class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                          <p class="h5 text-muted"><span class=" h1 PageTitle"><%=stats[4]%></span> Heures de travail</p>
                      </div>
                      <div
                          class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                          <p class="h5 text-muted "><span class=" h1 PageTitle"><%=stats[1]%></span> User stories</p>
                      </div>
                      <div
                          class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                          <p class="h5 text-muted"><span class=" h1 PageTitle"><%=stats[2]%></span> Semaines Totales</p>
                      </div>
                      <div
                          class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                          <p class="h5 text-muted"><span class=" h1 PageTitle"><%=(stats[5]/stats[1])*100 || 0%>%</span> Terminé</p>
                      </div>
                  </div>



            </div>
            <div class="row d-flex flex-column p-2">
              <%if(hasRunningSprint=="false"){%>
                <div class="row d-flex  flex-column p-1 mt-5 d-none">
                  <div class="container-fluid text-center mt-2 noNotificationsMessage h3">Vous n'avez aucune sprint en cours ! </div>
                </div>
                <%}else{%>
                <div class="col m-1 PageTitle h4 ml-0 p-0 d-flex justify-content-between">
                    <p>Sprint En cours </p>
                    <div class="d-flex">
                      <a type="button" class="btn btn-dark mr-3 pt-2 <%if(data._id!=projet.identifiantProductOwner){%>d-none<%}%>" href="/api/sprints/refuseOne/<%=sprintRunning._id%>">Refuser Ce Sprint<i class="bi bi-trash ml-1 "></i></button>
                      <a type="button" class="btn btn-danger mr-3 pt-2 <%if(data._id!=projet.identifiantProductOwner){%>d-none<%}%>" href="/api/sprints/cancelOne/<%=sprintRunning._id%>">Annuler Ce Sprint<i class="bi bi-x-lg ml-1 "></i></button>
                          <a type="button" class="btn btn-success text-white pt-2 mr-3 <%if(data._id!=projet.identifiantProductOwner){%>d-none<%}%>" href="/api/sprints/terminateOne/<%=sprintRunning._id%>">Accepter Ce Sprint<i class="bi bi-check2-all ml-1 "></i></a>
                        <a type="button" class="btn btn-primary mr-3 pt-2 text-light" href="/api/sprint/sprintBacklog/<%=sprintRunning._id%>">Sprint Backlog<i class="bi bi-diagram-3 ml-1 "></i></a>
                    </div>


                </div>

                <div class="row d-flex flex-column">
                    <div class="row m-1">
                        <div
                            class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                            <p class="h5 text-muted"><span class=" h1 PageTitle"><%
                              let startDate=new Date(sprintRunning.dateDebut);
                              startDate=startDate.getTime();
                              let periode=sprintRunning.jours*sprintRunning.semaines;
                              let todayDate=new Date();
                              todayDate=todayDate.getTime();
                              let finishDate=new Date((periode*1000*24*60*60)+startDate);
                              let remainingDate=finishDate-todayDate;
                              remainingDate/=(1000*60*60*24);
                              remainingDate=parseInt(remainingDate);
                              %><%=remainingDate%></span> Jours Restants</p>
                        </div>
                        <div
                            class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                            <p class="h5 text-muted"><span class=" h1 PageTitle"><%=achieved.perc%></span> Tâches</p>
                        </div>
                        <div
                            class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                            <p class="h5 text-muted"><span class=" h1 PageTitle"><%=achieved.response%></span> User Story</p>
                        </div>
                        <div
                            class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                            <p class="h5 text-muted"><span class=" h1 PageTitle"><%=done.cntr%></span> Tâches Terminées</p>
                        </div>
                        <div
                            class="col m-1 p-2 mt-2 projectInfosContainer d-flex flex-column justify-content-around">
                            <p class="h5 text-muted"><span class=" h1 PageTitle"><%=((done.cntr/achieved.perc)*100).toFixed(1)%>%</span> Terminé</p>
                        </div>
                    </div>
                    <div class="d-flex flex-column">
                        <p class=" text-center h5 mt-2" style="color:#4b49ac">Sprint Burn Down Chart</p>
                        <div class="d-flex justify-content-center">
                            <div class="col-11 justify-content-center mt-2">
                                <canvas id="myChart" height="400"></canvas>
                                <script>
                                  let count=parseInt("<%=sprintRunning.semaines%>"); 
                                  count=count*parseInt("<%=sprintRunning.jours%>");                                    
                                  var xValues =[];
                                  for(var i=0;i<count;i++)
                                  {
                                    xValues.push(i)
                                  }
                                  let arr="<%=stat.final%>";
                                  arr=arr.split(",");
                                  var yValues =arr;
                                  new Chart("myChart", {
                                    type: "line",
                                    data: {
                                      labels: xValues,
                                      datasets: [{
                                      label:"Nombre de tâches restantes par jour ",
                                        fill: false,
                                        lineTension: 0,
                                        backgroundColor: "#4b49ac",
                                        borderColor: "rgba(0,0,255,0.1)",
                                        data: yValues
                                      }]
                                    },
                                    options: {
                                      legend: {display: true},
                                      responsive:true,
                                      maintainAspectRatio: false,
                                      scales: {
                                        yAxes: [{ticks: {min: 6, max:16}}],
                                      }
                                    }
                                  });

                              </script>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-column">
                        <p class=" text-center h5 mt-2" style="color: #0091B3;">Sprint Burn Up Chart</p>
                        <div class="d-flex justify-content-center">
                            <div class="col-11 justify-content-center mt-2">
                                <canvas id="myChart1" height="400"></canvas>
                                <script>
                                  arra="<%=stat1.final%>";
                                  arra=arra.split(",");
                                  var yValues =arra;
                                  new Chart("myChart1", {
                                    type: "line",
                                    data: {
                                      labels: xValues,
                                      datasets: [{
                                      label:"Nombre de tâches terminé jusqu'à ce jour ",
                                        fill: false,
                                        lineTension: 0,
                                        backgroundColor: "#0091B3",
                                        borderColor: "rgba(0,0,255,0.1)",
                                        data: yValues
                                      }]
                                    },
                                    options: {
                                      legend: {display: true},
                                      responsive:true,
                                      maintainAspectRatio: false,
                                      scales: {
                                        yAxes: [{ticks: {min: 6, max:16}}],
                                      }
                                    }
                                  });

                              </script>
                            </div>
                        </div>
                    </div>
                  
                </div>
                <%}%>
            </div>

        </div>

    </div>
    </div>
  </div>
</body>
</html>